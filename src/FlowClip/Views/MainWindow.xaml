<Window x:Class="FlowClip.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:FlowClip.ViewModels"
        xmlns:controls="clr-namespace:FlowClip.Views.Controls"
        Title="FlowClip"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize"
        Topmost="True"
        ShowInTaskbar="False"
        SizeToContent="WidthAndHeight"
        Left="{Binding WindowLeft, Mode=TwoWay}"
        Top="{Binding WindowTop, Mode=TwoWay}">

    <!-- Animations are handled programmatically in code-behind -->

    <Grid>
        <StackPanel HorizontalAlignment="Left">
            <!-- Floating Widget Button - Circular when collapsed -->
            <Border x:Name="WidgetButton"
                    Width="48"
                    Height="48"
                    Background="{StaticResource AccentBrush}"
                    CornerRadius="24"
                    HorizontalAlignment="Left"
                    Cursor="Hand"
                    MouseLeftButtonDown="WidgetButton_MouseLeftButtonDown"
                    MouseLeftButtonUp="WidgetButton_MouseLeftButtonUp"
                    MouseMove="WidgetButton_MouseMove">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.4" Color="#000000"/>
                </Border.Effect>

                <Grid>
                    <!-- Icon (visible when collapsed) -->
                    <TextBlock x:Name="CollapsedIcon"
                               Text="ðŸ“‹"
                               FontSize="18"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>

                    <!-- Expanded Content (visible when expanded) -->
                    <StackPanel x:Name="ExpandedContent"
                                Orientation="Horizontal"
                                Margin="14,0,8,0"
                                VerticalAlignment="Center"
                                Visibility="Collapsed">
                        <!-- Icon in expanded state -->
                        <Border Background="White"
                                Opacity="0.2"
                                CornerRadius="12"
                                Width="28" Height="28">
                            <TextBlock Text="ðŸ“‹"
                                       FontSize="13"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                        </Border>

                        <TextBlock Text="FlowClip"
                                   FontSize="13"
                                   FontWeight="SemiBold"
                                   Foreground="White"
                                   VerticalAlignment="Center"
                                   Margin="10,0,0,0"/>
                        <TextBlock FontSize="12"
                                   Foreground="#CCFFFFFF"
                                   VerticalAlignment="Center"
                                   Margin="6,0,0,0">
                            <Run Text="â€¢"/>
                            <Run Text="{Binding Entries.Count, Mode=OneWay}"/>
                        </TextBlock>

                        <!-- Pause/Resume Button -->
                        <Button Style="{StaticResource IconButtonStyle}"
                                ToolTip="{Binding IsMonitoringPaused, Converter={StaticResource PauseButtonTooltipConverter}}"
                                Margin="10,0,0,0"
                                Command="{Binding TogglePauseMonitoringCommand}">
                            <TextBlock Text="{Binding IsMonitoringPaused, Converter={StaticResource PauseButtonIconConverter}}"
                                       FontSize="12"
                                       Foreground="{Binding IsMonitoringPaused, Converter={StaticResource PauseButtonColorConverter}}"/>
                        </Button>

                        <!-- Settings Button -->
                        <Button Style="{StaticResource IconButtonStyle}"
                                ToolTip="Settings"
                                Margin="2,0,0,0"
                                Command="{Binding OpenSettingsCommand}">
                            <TextBlock Text="âš™" FontSize="12" Foreground="White"/>
                        </Button>

                        <!-- Close Button -->
                        <Button Style="{StaticResource IconButtonStyle}"
                                ToolTip="Close FlowClip"
                                Margin="2,0,0,0"
                                Command="{Binding ExitCommand}">
                            <TextBlock Text="âœ•" FontSize="12" Foreground="#FFAAAA"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- History Panel (expandable) -->
            <Border x:Name="HistoryPanel"
                    Background="{StaticResource AcrylicBackgroundBrush}"
                    CornerRadius="16"
                    Margin="0,8,0,0"
                    Width="340"
                    HorizontalAlignment="Left"
                    ClipToBounds="True"
                    Visibility="Collapsed">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="3" Opacity="0.5" Color="#000000"/>
                </Border.Effect>

                <Grid Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Entry List -->
                    <Border Grid.Row="0"
                            CornerRadius="8">
                        <ScrollViewer VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled">
                            <ItemsControl ItemsSource="{Binding Entries}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="{x:Type vm:ClipboardEntryViewModel}">
                                        <Border Margin="0,0,0,6"
                                                Cursor="Hand"
                                                MouseLeftButtonUp="Entry_Click">
                                            <controls:ClipboardEntryControl DataContext="{Binding}"/>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>

                    <!-- Empty State -->
                    <StackPanel Grid.Row="0"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding Entries.Count, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="ðŸ“‹"
                                   FontSize="32"
                                   HorizontalAlignment="Center"
                                   Opacity="0.5"/>
                        <TextBlock Text="No clipboard history yet"
                                   FontSize="13"
                                   Foreground="{StaticResource SecondaryForegroundBrush}"
                                   HorizontalAlignment="Center"
                                   Margin="0,8,0,0"/>
                        <TextBlock Text="Copy something to get started"
                                   FontSize="11"
                                   Foreground="{StaticResource SecondaryForegroundBrush}"
                                   HorizontalAlignment="Center"
                                   Opacity="0.7"/>
                    </StackPanel>

                    <!-- Footer -->
                    <Grid Grid.Row="1" Margin="0,12,0,0">
                        <Button Content="Clear All"
                                Style="{StaticResource ModernButtonStyle}"
                                HorizontalAlignment="Left"
                                Padding="12,6"
                                FontSize="12"
                                Command="{Binding ClearAllCommand}"/>

                        <TextBlock Text="Ctrl+Shift+V"
                                   FontSize="10"
                                   Foreground="{StaticResource SecondaryForegroundBrush}"
                                   HorizontalAlignment="Right"
                                   VerticalAlignment="Center"
                                   Opacity="0.7"/>
                    </Grid>

                    <!-- Resize Grip (bottom-right corner) -->
                    <Canvas Grid.Row="1"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            Margin="0,0,-8,-8"
                            Width="20" Height="20"
                            Cursor="SizeNWSE"
                            Background="Transparent"
                            MouseLeftButtonDown="ResizeGrip_MouseLeftButtonDown"
                            MouseLeftButtonUp="ResizeGrip_MouseLeftButtonUp"
                            MouseMove="ResizeGrip_MouseMove">
                        <!-- Grip dots -->
                        <Ellipse Width="3" Height="3" Fill="{StaticResource SecondaryForegroundBrush}" Canvas.Right="4" Canvas.Bottom="4" Opacity="0.5"/>
                        <Ellipse Width="3" Height="3" Fill="{StaticResource SecondaryForegroundBrush}" Canvas.Right="9" Canvas.Bottom="4" Opacity="0.5"/>
                        <Ellipse Width="3" Height="3" Fill="{StaticResource SecondaryForegroundBrush}" Canvas.Right="4" Canvas.Bottom="9" Opacity="0.5"/>
                    </Canvas>
                </Grid>
            </Border>
        </StackPanel>
    </Grid>
</Window>
